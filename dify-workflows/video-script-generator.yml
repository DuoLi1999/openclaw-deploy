app:
  description: 'äº¤é€šå®‰å…¨çŸ­è§†é¢‘è„šæœ¬ç”Ÿæˆï¼Œè¾“å‡ºåŒ…å«åˆ†é•œè¡¨ã€å£æ’­æ–‡æ¡ˆã€æ‹æ‘„å»ºè®®çš„å®Œæ•´è§†é¢‘è„šæœ¬'
  icon: "\U0001F3AC"
  icon_background: '#E4FBCC'
  icon_type: emoji
  mode: workflow
  name: video-script-generator
  use_icon_as_answer_icon: false
dependencies: []
kind: app
version: 0.3.1
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      enabled: false
    opening_statement: ''
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: llm
      id: start-to-llm-structure
      source: start_node
      sourceHandle: source
      target: llm_structure
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: llm
      id: llm-structure-to-llm-script
      source: llm_structure
      sourceHandle: source
      target: llm_script
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: llm-script-to-code
      source: llm_script
      sourceHandle: source
      target: code_validate
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: if-else
      id: code-to-ifelse
      source: code_validate
      sourceHandle: source
      target: if_else_check
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: template-transform
      id: ifelse-to-template-pass
      source: if_else_check
      sourceHandle: 'true'
      target: template_output
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: template-transform
      id: ifelse-to-template-warn
      source: if_else_check
      sourceHandle: 'false'
      target: template_warn
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: template-transform
        targetType: variable-aggregator
      id: template-pass-to-agg
      source: template_output
      sourceHandle: source
      target: agg_result
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: template-transform
        targetType: variable-aggregator
      id: template-warn-to-agg
      source: template_warn
      sourceHandle: source
      target: agg_result
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: variable-aggregator
        targetType: end
      id: agg-to-end
      source: agg_result
      sourceHandle: source
      target: end_node
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: 'è¾“å…¥è§†é¢‘è„šæœ¬ç”Ÿæˆæ‰€éœ€çš„å‚æ•°'
        selected: false
        title: å¼€å§‹
        type: start
        variables:
        - label: ä¸»é¢˜å…³é”®è¯
          max_length: 200
          options: []
          required: true
          type: text-input
          variable: topic
        - label: è¡¥å……æè¿°
          max_length: 500
          options: []
          required: false
          type: paragraph
          variable: description
        - label: æ–‡æ¡ˆé£æ ¼
          max_length: null
          options:
          - formal
          - friendly
          - humorous
          - warning
          required: true
          type: select
          variable: style
        - label: è§†é¢‘æ—¶é•¿
          max_length: null
          options:
          - 15s
          - 30s
          - 60s
          required: true
          type: select
          variable: duration
        - label: ç›®æ ‡å¹³å°
          max_length: null
          options:
          - douyin
          - kuaishou
          required: true
          type: select
          variable: platform
      height: 90
      id: start_node
      position:
        x: 30
        y: 282
      positionAbsolute:
        x: 30
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: 'ç¡®å®šè§†é¢‘çš„ç»“æ„æ¡†æ¶å’Œæ¯ä¸ªåœºæ™¯çš„æ¦‚è¦'
        title: è„šæœ¬ç»“æ„è§„åˆ’
        type: llm
        model:
          provider: deepseek
          name: deepseek-chat
          mode: chat
          completion_params:
            temperature: 0.7
        prompt_template:
        - role: system
          text: |
            ä½ æ˜¯ä¸€åçŸ­è§†é¢‘å†…å®¹ç­–åˆ’å¸ˆï¼Œæ“…é•¿ä¸ºäº¤é€šå®‰å…¨å®£ä¼ åˆ¶ä½œåˆ†é•œè„šæœ¬ç»“æ„ã€‚

            ## çŸ­è§†é¢‘ç»“æ„å…¬å¼

            ### 15ç§’è§†é¢‘ï¼ˆ3-4ä¸ªåˆ†é•œï¼‰
            - [0-3s] Hookï¼šå¼€åœºå†²å‡»ç”»é¢æˆ–æ‚¬å¿µé—®é¢˜
            - [3-10s] æ ¸å¿ƒå†…å®¹ï¼šä¸€ä¸ªæ ¸å¿ƒä¿¡æ¯ç‚¹
            - [10-15s] CTAï¼šè¡ŒåŠ¨å·å¬/è­¦ç¤ºæ€»ç»“

            ### 30ç§’è§†é¢‘ï¼ˆ5-7ä¸ªåˆ†é•œï¼‰
            - [0-3s] Hookï¼šå¼ºå¸å¼•åŠ›å¼€åœº
            - [3-12s] é—®é¢˜/æ¡ˆä¾‹å‘ˆç°
            - [12-22s] æ ¸å¿ƒè§£è¯»/çŸ¥è¯†ç‚¹
            - [22-28s] æ€»ç»“å¼ºåŒ–
            - [28-30s] CTA

            ### 60ç§’è§†é¢‘ï¼ˆ8-12ä¸ªåˆ†é•œï¼‰
            - [0-5s] Hookï¼šå¼ºå¸å¼•åŠ›å¼€åœº
            - [5-15s] é—®é¢˜/æ¡ˆä¾‹å‘ˆç°ï¼ˆå¯æœ‰è½¬æŠ˜ï¼‰
            - [15-35s] æ·±åº¦è§£è¯»ï¼ˆ2-3ä¸ªçŸ¥è¯†ç‚¹ï¼‰
            - [35-50s] æ¡ˆä¾‹/æ•°æ®ä½è¯
            - [50-58s] æ€»ç»“å‡å
            - [58-60s] CTA

            ## å¹³å°å·®å¼‚

            - **douyinï¼ˆæŠ–éŸ³ï¼‰**ï¼šèŠ‚å¥å¿«ï¼Œç”»é¢åˆ‡æ¢é¢‘ç¹ï¼Œå‰3ç§’å†³å®šç”Ÿæ­»ã€‚é€‚åˆï¼šæ•°æ®å†²å‡»ã€æ‚¬å¿µåè½¬ã€æƒ…æ„Ÿæ•…äº‹
            - **kuaishouï¼ˆå¿«æ‰‹ï¼‰**ï¼šæ›´æ¥åœ°æ°”ï¼Œå¯ä»¥æ…¢ä¸€ç‚¹å±•å¼€ï¼Œé‡è§†çœŸå®æ„Ÿã€‚é€‚åˆï¼šçœŸäººå‡ºé•œè®²è§£ã€ç”Ÿæ´»åœºæ™¯ã€æœ´å®å™äº‹

            ## è¾“å‡ºæ ¼å¼

            è¾“å‡ºæ¯ä¸ªåœºæ™¯çš„æ¦‚è¦ï¼ŒåŒ…å«ï¼š
            - æ—¶é—´æ®µ
            - åœºæ™¯æ ‡é¢˜
            - å†…å®¹æ¦‚è¦ï¼ˆä¸€å¥è¯ï¼‰
            - ç”»é¢ç±»å‹ï¼ˆå®æ‹/åŠ¨ç”»/å­—å¹•å¡/ç›‘æ§ç”»é¢/æ•°æ®å›¾è¡¨ï¼‰

            ç”¨è¡¨æ ¼æ ¼å¼ï¼š
            | æ—¶é—´æ®µ | åœºæ™¯æ ‡é¢˜ | å†…å®¹æ¦‚è¦ | ç”»é¢ç±»å‹ |
        - role: user
          text: |
            è¯·ä¸ºä»¥ä¸‹ä¸»é¢˜è®¾è®¡è§†é¢‘è„šæœ¬ç»“æ„ï¼š

            **ä¸»é¢˜**ï¼š{{#start_node.topic#}}
            **è¡¥å……æè¿°**ï¼š{{#start_node.description#}}
            **é£æ ¼**ï¼š{{#start_node.style#}}
            **è§†é¢‘æ—¶é•¿**ï¼š{{#start_node.duration#}}
            **ç›®æ ‡å¹³å°**ï¼š{{#start_node.platform#}}
        vision:
          enabled: false
          configs:
            variable_selector: []
        memory:
          enabled: false
          window:
            enabled: false
            size: 50
        context:
          enabled: false
          variable_selector: []
        structured_output:
          enabled: false
        retry_config:
          enabled: false
          max_retries: 1
          retry_interval: 1000
          exponential_backoff:
            enabled: false
            multiplier: 2
            max_interval: 10000
      height: 90
      id: llm_structure
      position:
        x: 334
        y: 282
      positionAbsolute:
        x: 334
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: 'åŸºäºç»“æ„æ¡†æ¶ç”Ÿæˆå®Œæ•´çš„åˆ†é•œè¡¨è„šæœ¬'
        title: è¯¦ç»†è„šæœ¬ç”Ÿæˆ
        type: llm
        model:
          provider: deepseek
          name: deepseek-chat
          mode: chat
          completion_params:
            temperature: 0.8
        prompt_template:
        - role: system
          text: |
            ä½ æ˜¯ä¸€åä¸“ä¸šçš„çŸ­è§†é¢‘è„šæœ¬ç¼–å‰§ï¼Œä¸ºäº¤é€šå®‰å…¨å®£ä¼ ç¼–å†™å®Œæ•´çš„åˆ†é•œè„šæœ¬ã€‚

            ## è„šæœ¬è¾“å‡ºæ ¼å¼

            å¯¹æ¯ä¸ªåˆ†é•œåœºæ™¯ï¼Œä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š

            ---
            **åœºæ™¯ X** [æ—¶é—´æ®µ]
            **ç”»é¢æè¿°**ï¼šï¼ˆè¯¦ç»†æè¿°é•œå¤´ç”»é¢å†…å®¹ï¼ŒåŒ…æ‹¬æ™¯åˆ«ã€è¿é•œã€ç”»é¢å…ƒç´ ï¼‰
            **å£æ’­æ–‡æ¡ˆ**ï¼šï¼ˆæ¼”å‘˜/é…éŸ³çš„å…·ä½“å°è¯ï¼Œå£è¯­åŒ–çŸ­å¥ï¼‰
            **å­—å¹•**ï¼šï¼ˆå±å¹•ä¸Šéœ€è¦æ˜¾ç¤ºçš„æ–‡å­—ï¼Œå«å¼ºè°ƒå…³é”®è¯ï¼‰
            **BGM/éŸ³æ•ˆ**ï¼šï¼ˆèƒŒæ™¯éŸ³ä¹é£æ ¼æˆ–å…·ä½“éŸ³æ•ˆå»ºè®®ï¼‰
            **æ‹æ‘„å»ºè®®**ï¼šï¼ˆæœºä½ã€å…‰çº¿ã€é“å…·ç­‰å®æ“å»ºè®®ï¼‰
            ---

            ## å£æ’­æ–‡æ¡ˆè¦æ±‚

            1. æ¯å¥ä¸è¶…è¿‡15ä¸ªå­—ï¼Œé•¿çŸ­å¥äº¤æ›¿
            2. å£è¯­åŒ–è¡¨è¾¾ï¼Œåƒåœ¨å’Œæœ‹å‹èŠå¤©
            3. å…³é”®æ•°æ®å’Œæ³•è§„è¦å‡†ç¡®
            4. å…¨éƒ¨å£æ’­æ–‡æ¡ˆåŠ èµ·æ¥ä¸è¶…è¿‡ï¼š
               - 15ç§’è§†é¢‘ï¼š50å­—
               - 30ç§’è§†é¢‘ï¼š100å­—
               - 60ç§’è§†é¢‘ï¼š200å­—
            5. å‰3ç§’çš„Hookå¿…é¡»æ˜¯æœ€å¼ºçš„é‚£å¥è¯

            ## é£æ ¼é€‚é…

            - **formal**ï¼šä¸“ä¸šæƒå¨æ„Ÿï¼Œå¯ç”¨æ–°é—»æ’­æŠ¥è…”è°ƒ
            - **friendly**ï¼šé‚»å®¶å¤§å“¥/å§å§çš„è¯­æ°”ï¼Œæ¸©æš–äº²åˆ‡
            - **humorous**ï¼šåè½¬/åæ§½/å¤¸å¼ å¯¹æ¯”ï¼Œä½†ä¸æ¶ˆè§£å®‰å…¨ä¸¥è‚ƒæ€§
            - **warning**ï¼šæ²‰é‡/éœ‡æ’¼/å‘äººæ·±çœï¼Œæ•°æ®å’Œæ¡ˆä¾‹å†²å‡»

            ## æ³¨æ„äº‹é¡¹

            - ä¸ä½¿ç”¨è¡€è…¥ç”»é¢æè¿°
            - æ³•è§„å¼•ç”¨é¡»å‡†ç¡®
            - ç”»é¢æè¿°è¦å¯æ‰§è¡Œï¼ˆä¸è¦å†™"å®‡å®™çº§ç‰¹æ•ˆ"è¿™ç§æ— æ³•å®ç°çš„å†…å®¹ï¼‰
            - æœ€åä¸€ä¸ªåœºæ™¯å¿…é¡»æœ‰æ˜ç¡®çš„è¡ŒåŠ¨å·å¬
        - role: user
          text: |
            è¯·åŸºäºä»¥ä¸‹è„šæœ¬ç»“æ„ï¼Œç”Ÿæˆå®Œæ•´çš„åˆ†é•œè„šæœ¬ï¼š

            **ä¸»é¢˜**ï¼š{{#start_node.topic#}}
            **é£æ ¼**ï¼š{{#start_node.style#}}
            **æ—¶é•¿**ï¼š{{#start_node.duration#}}
            **å¹³å°**ï¼š{{#start_node.platform#}}

            **è„šæœ¬ç»“æ„**ï¼š
            {{#llm_structure.text#}}
        vision:
          enabled: false
          configs:
            variable_selector: []
        memory:
          enabled: false
          window:
            enabled: false
            size: 50
        context:
          enabled: false
          variable_selector: []
        structured_output:
          enabled: false
        retry_config:
          enabled: false
          max_retries: 1
          retry_interval: 1000
          exponential_backoff:
            enabled: false
            multiplier: 2
            max_interval: 10000
      height: 90
      id: llm_script
      position:
        x: 638
        y: 282
      positionAbsolute:
        x: 638
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: 'æ ¡éªŒè„šæœ¬æ ¼å¼ã€å£æ’­å­—æ•°ã€åˆ†é•œå®Œæ•´æ€§'
        title: è„šæœ¬æ ¼å¼æ ¡éªŒ
        type: code
        code_language: python3
        code: |
          def main(script: str, duration: str) -> dict:
              import re

              # Count scenes
              scene_matches = re.findall(r'\*\*åœºæ™¯\s*\d+', script)
              scene_count = len(scene_matches)

              # Extract oral text (å£æ’­æ–‡æ¡ˆ sections)
              oral_sections = re.findall(r'å£æ’­æ–‡æ¡ˆ[ï¼š:]\s*[ï¼ˆ(]?(.+?)[ï¼‰)]?\s*(?:\n|$)', script, re.DOTALL)
              oral_text = ''.join(oral_sections)
              oral_text = re.sub(r'[#*_\[\]()ï¼ˆï¼‰ã€ã€‘ã€Œã€ã€ã€\-â€”â€¦\n\r\t"""]', '', oral_text)
              oral_text = re.sub(r'\s+', '', oral_text)
              oral_count = len(oral_text)

              # Duration limits
              duration_map = {
                  '15s': {'max_oral': 60, 'min_scenes': 2, 'max_scenes': 5},
                  '30s': {'max_oral': 120, 'min_scenes': 4, 'max_scenes': 8},
                  '60s': {'max_oral': 220, 'min_scenes': 6, 'max_scenes': 14},
              }
              limits = duration_map.get(duration, duration_map['30s'])

              issues = []
              is_valid = "true"

              if oral_count > limits['max_oral']:
                  issues.append("å£æ’­æ–‡å­—è¶…å‡ºé™åˆ¶ï¼šå½“å‰çº¦" + str(oral_count) + "å­—ï¼Œ" + duration + "è§†é¢‘ä¸Šé™" + str(limits['max_oral']) + "å­—")
                  is_valid = "false"

              if scene_count < limits['min_scenes']:
                  issues.append("åˆ†é•œæ•°é‡ä¸è¶³ï¼šå½“å‰" + str(scene_count) + "ä¸ªï¼Œ" + duration + "è§†é¢‘å»ºè®®è‡³å°‘" + str(limits['min_scenes']) + "ä¸ª")

              if scene_count > limits['max_scenes']:
                  issues.append("åˆ†é•œæ•°é‡è¿‡å¤šï¼šå½“å‰" + str(scene_count) + "ä¸ªï¼Œ" + duration + "è§†é¢‘å»ºè®®ä¸è¶…è¿‡" + str(limits['max_scenes']) + "ä¸ª")

              issues_text = "ï¼›".join(issues) if issues else "è„šæœ¬æ ¼å¼æ ¡éªŒé€šè¿‡"

              return {
                  "is_valid": is_valid,
                  "issues": issues_text,
                  "scene_count": scene_count,
                  "oral_count": oral_count
              }
        variables:
        - value_selector:
          - llm_script
          - text
          variable: script
        - value_selector:
          - start_node
          - duration
          variable: duration
        outputs:
          is_valid:
            type: string
            children: null
          issues:
            type: string
            children: null
          scene_count:
            type: number
            children: null
          oral_count:
            type: number
            children: null
      height: 90
      id: code_validate
      position:
        x: 942
        y: 282
      positionAbsolute:
        x: 942
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: 'æ ¹æ®æ ¡éªŒç»“æœå†³å®šè¾“å‡ºè·¯å¾„'
        title: æ ¡éªŒåˆ¤æ–­
        type: if-else
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: cond-is-valid
            value: 'true'
            varType: string
            variable_selector:
            - code_validate
            - is_valid
          id: 'true'
          logical_operator: and
      height: 90
      id: if_else_check
      position:
        x: 1246
        y: 282
      positionAbsolute:
        x: 1246
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: 'æ ¡éªŒé€šè¿‡ï¼Œæ ¼å¼åŒ–æœ€ç»ˆè¾“å‡º'
        title: è„šæœ¬è¾“å‡º
        type: template-transform
        template: |
          {{ script }}

          ---
          ğŸ“Š è„šæœ¬ä¿¡æ¯
          - å¹³å°ï¼š{% if platform == 'douyin' %}æŠ–éŸ³{% elif platform == 'kuaishou' %}å¿«æ‰‹{% else %}{{ platform }}{% endif %}
          - è§†é¢‘æ—¶é•¿ï¼š{{ duration }}
          - åˆ†é•œæ•°é‡ï¼š{{ scene_count }} ä¸ª
          - å£æ’­å­—æ•°ï¼šçº¦{{ oral_count }}å­—
          - æ ¡éªŒçŠ¶æ€ï¼šâœ… é€šè¿‡
        variables:
        - value_selector:
          - llm_script
          - text
          variable: script
        - value_selector:
          - start_node
          - platform
          variable: platform
        - value_selector:
          - start_node
          - duration
          variable: duration
        - value_selector:
          - code_validate
          - scene_count
          variable: scene_count
        - value_selector:
          - code_validate
          - oral_count
          variable: oral_count
      height: 90
      id: template_output
      position:
        x: 1550
        y: 132
      positionAbsolute:
        x: 1550
        y: 132
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: 'æ ¡éªŒæœ‰é—®é¢˜ï¼Œé™„å¸¦è­¦å‘Šä¿¡æ¯è¾“å‡º'
        title: å¸¦è­¦å‘Šè¾“å‡º
        type: template-transform
        template: |
          {{ script }}

          ---
          ğŸ“Š è„šæœ¬ä¿¡æ¯
          - å¹³å°ï¼š{% if platform == 'douyin' %}æŠ–éŸ³{% elif platform == 'kuaishou' %}å¿«æ‰‹{% else %}{{ platform }}{% endif %}
          - è§†é¢‘æ—¶é•¿ï¼š{{ duration }}
          - åˆ†é•œæ•°é‡ï¼š{{ scene_count }} ä¸ª
          - å£æ’­å­—æ•°ï¼šçº¦{{ oral_count }}å­—
          - æ ¡éªŒçŠ¶æ€ï¼šâš ï¸ æœ‰é—®é¢˜

          âš ï¸ æ ¡éªŒé—®é¢˜ï¼š{{ issues }}
          å»ºè®®æ ¹æ®ä»¥ä¸Šé—®é¢˜è°ƒæ•´è„šæœ¬åä½¿ç”¨ã€‚
        variables:
        - value_selector:
          - llm_script
          - text
          variable: script
        - value_selector:
          - start_node
          - platform
          variable: platform
        - value_selector:
          - start_node
          - duration
          variable: duration
        - value_selector:
          - code_validate
          - scene_count
          variable: scene_count
        - value_selector:
          - code_validate
          - oral_count
          variable: oral_count
        - value_selector:
          - code_validate
          - issues
          variable: issues
      height: 90
      id: template_warn
      position:
        x: 1550
        y: 432
      positionAbsolute:
        x: 1550
        y: 432
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: 'åˆå¹¶ä¸¤ä¸ªåˆ†æ”¯çš„è¾“å‡º'
        title: åˆå¹¶ç»“æœ
        type: variable-aggregator
        variables:
        - - template_output
          - output
        - - template_warn
          - output
        output_type: string
        advanced_settings: null
      height: 90
      id: agg_result
      position:
        x: 1854
        y: 282
      positionAbsolute:
        x: 1854
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        outputs:
        - value_selector:
          - agg_result
          - output
          value_type: string
          variable: result
        - value_selector:
          - start_node
          - duration
          value_type: string
          variable: total_duration
        - value_selector:
          - code_validate
          - scene_count
          value_type: number
          variable: scene_count
        selected: false
        title: è¾“å‡º
        type: end
      height: 90
      id: end_node
      position:
        x: 2158
        y: 282
      positionAbsolute:
        x: 2158
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    viewport:
      x: 0
      y: 0
      zoom: 0.5
